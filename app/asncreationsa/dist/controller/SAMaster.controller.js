sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/m/MessageBox"],function(e,t,s,r){"use strict";return e.extend("sap.fiori.asncreationsa.controller.SAMaster",{onInit:function(){this.router=sap.ui.core.UIComponent.getRouterFor(this);this.router.attachRoutePatternMatched(this.onRouteMatched,this);this.filterModel=new sap.ui.model.json.JSONModel;this.listTemp=this.byId("idlistitem").clone();this.DataModel=new sap.ui.model.json.JSONModel;this.DataModel.setSizeLimit(1e7);this.getView().setModel(this.DataModel,"DataModel")},onRouteMatched:function(e){if(e.getParameter("name")!=="SAMaster"){return}sap.ui.core.BusyIndicator.show();var t=this;var s=sap.ui.core.format.DateFormat.getDateInstance({pattern:"ddMMMyyyy"});this.ASNtodate=new Date;this.ASNfromdate=new Date(this.ASNtodate.getTime()-30*24*3600*1e3);this.ASNtodate=s.format(this.ASNtodate);this.ASNfromdate=s.format(this.ASNfromdate);this.ASNtodate=this.ASNtodate.substring(0,2)+" "+this.ASNtodate.substring(2,5)+" "+this.ASNtodate.substring(5,9);this.ASNfromdate=this.ASNfromdate.substring(0,2)+" "+this.ASNfromdate.substring(2,5)+" "+this.ASNfromdate.substring(5,9);this.unitCode=sessionStorage.getItem("unitCode")||"P01";this.AddressCodeASNSA=sessionStorage.getItem("AddressCodeASNSA")||"JSE-01-01";this.LoggedUser=sessionStorage.getItem("LoggedUser")||"rajeshsehgal@impauto.com";var i=this.getOwnerComponent().getModel();i.read("/GetASNHeaderList",{urlParameters:{username:this.LoggedUser,AddressCode:this.AddressCodeASNSA,PoNumber:"",ASNNumber:"",ASNFromdate:this.ASNfromdate,ASNTodate:this.ASNtodate,InvoiceStatus:"",MRNStatus:"",ApprovedBy:""},success:function(e){sap.ui.core.BusyIndicator.hide();t.PlantCode=e.results[0].PlantCode;t.ASNStatus=e.results[0].ASNStatus;t.DataModel.setData(e);t.DataModel.refresh();t.routeToDetail()},error:function(e){sap.ui.core.BusyIndicator.hide();var t=JSON.parse(e.response.body);r.error(t.error.message.value)}})},routeToDetail:function(){var e=this.byId("masterListId").getItems()[0];this.byId("masterListId").setSelectedItem(e,true);if(e){this.AsnNumber=e.getProperty("title").replace(/\//g,"-");this.router.navTo("SADetail",{AsnNumber:this.AsnNumber,AddressCode:this.AddressCodeASNSA,UnitCode:this.PlantCode,ASNStatus:this.ASNStatus})}else{this.router.navTo("NoData")}},onListItemPress:function(e){var t=e.getParameter("listItem").getBindingContext("DataModel").getProperty();var s=e.getParameter("listItem").getProperty("title").replace(/\//g,"-");this.router.navTo("SADetail",{AsnNumber:s,AddressCode:this.AddressCodeASNSA,UnitCode:t.PlantCode,ASNStatus:t.ASNStatus})},onSearch:function(e){if(e.getParameter("refreshButtonPressed")===true){this.getView().byId("masterListId").getBinding("items").refresh(true)}else{sap.ui.core.BusyIndicator.show();var t=e.getParameter("query");var s=this.getOwnerComponent().getModel();s.read("/GetASNHeaderList",{urlParameters:{search:t,username:this.LoggedUser,AddressCode:this.AddressCodeASNSA,PoNumber:"",ASNNumber:"",ASNFromdate:this.ASNfromdate,ASNTodate:this.ASNtodate,InvoiceStatus:"",MRNStatus:"",ApprovedBy:""},success:function(e){sap.ui.core.BusyIndicator.hide();this.PlantCode=e.results[0].PlantCode;that.DataModel.setData(e);that.DataModel.refresh();this.routeToDetail()},error:function(e){sap.ui.core.BusyIndicator.hide();var t=JSON.parse(e.response.body);r.error(t.error.message.value)}})}},onFilter:function(){if(!this.filterFragment){this.filterFragment=sap.ui.xmlfragment("sap.fiori.asncreationsa.fragment.filterFragment",this);this.filterFragment.setModel(this.filterModel,"filterModel")}this.filterVisibleModel=new sap.ui.model.json.JSONModel({Werks:true,Status:true});this.filterFragment.setModel(this.filterVisibleModel,"FilterVisibleModel");this.filterFragment.open()},onPlantValueHelp:function(){if(!this.PlantF4Frag){this.PlantF4Frag=sap.ui.xmlfragment("sap.fiori.asncreationsa.fragment.PlantFrag",this);this.PlantF4Temp=sap.ui.getCore().byId("plantTempId").clone()}this.PlantF4Frag.setModel(new t(JSON.parse(sessionStorage.getItem("CodeDetails"))),"plantModel");this.getView().addDependent(this.PlantF4Frag);sap.ui.getCore().byId("plantF4Id")._searchField.setVisible(false);this.PlantF4Frag.open()},handlePlantClose:function(e){var t=e.getParameter("selectedItem").getProperty("title");this.desc=e.getParameter("selectedItem").getProperty("description");this.filterModel.getData().Werks=t;this.filterModel.refresh("true");this.PlantF4Frag.destroy();this.PlantF4Frag=""},handlePlantCancel:function(){this.PlantF4Frag.destroy();this.PlantF4Frag=""},onFilterSubmit:function(){var e=this.filterModel.getData();this.AddressCodePO=sessionStorage.getItem("AddressCodePO")||"JSE-01-01";var t=e.Status;var s=e.Werks;if(!s){s=sessionStorage.getItem("unitCode")||"P01"}if(!t){this.getView().byId("masterListId").bindItems({path:"/PurchaseOrders",parameters:{custom:{AddressCode:this.AddressCodePO,UnitCode:s},countMode:"None"},template:this._listTemp})}else{this.getView().byId("masterListId").bindItems({path:"/PurchaseOrders?search="+t,parameters:{custom:{AddressCode:this.AddressCodePO,UnitCode:s}},template:this._listTemp})}if(e.Werks){this.PlantFilter=s+"("+this.desc+")";this.getView().byId("plantFilterId").setText(this.PlantFilter)}this.getView().byId("clearFilterId").setVisible(true);this.filterFragment.close();this.filterFragment.destroy();this.filterFragment="";this.routeToDetail()},onFilterCancel:function(){this.filterFragment.close();this.filterFragment.destroy();this.filterFragment=""},onFilterClear:function(){this.getView().byId("clearFilterId").setVisible(false);this.getView().byId("plantFilterId").setText("");var e=sessionStorage.getItem("unitCode")||"P01";this.AddressCodePO=sessionStorage.getItem("AddressCodePO")||"JSE-01-01";this.getView().byId("masterListId").bindItems({path:"/PurchaseOrders",parameters:{custom:{AddressCode:this.AddressCodePO,UnitCode:e},countMode:"None"},template:this._listTemp});this.routeToDetail()}})});