sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,o,i,a){"use strict";return e.extend("sap.fiori.asncreationsa.controller.SADetail",{onInit:function(){this.oDataModel=sap.ui.getCore().getModel("oDataModel");this.getView().setModel(this.oDataModel);this.router=sap.ui.core.UIComponent.getRouterFor(this);this.router.attachRouteMatched(this.handleRouteMatched,this);this.detailHeaderModel=new sap.ui.model.json.JSONModel;this.detailHeaderModel.setSizeLimit(1e3);this.getView().setModel(this.detailHeaderModel,"detailHeaderModel");this.detailModel=new sap.ui.model.json.JSONModel;this.detailModel.setSizeLimit(1e3);this.getView().setModel(this.detailModel,"detailModel");this.materialDescModel=new sap.ui.model.json.JSONModel;this.materialDescModel.setSizeLimit(1e3);this.getView().setModel(this.materialDescModel,"materialDescModel");this.ConfirmFragModel=new sap.ui.model.json.JSONModel;this.getView().addStyleClass("sapUiSizeCompact");this.getView().byId("ObjectId").onAfterRendering=function(){sap.m.ObjectHeader.prototype.onAfterRendering.apply(this,arguments);this.$().find(".sapMOHTitleDiv").find(".sapMText").css("color","#af2323")}},handleRouteMatched:function(e){if(e.getParameter("name")==="SADetail"){this.odata={};var o=this;var i=this.getOwnerComponent().getModel();var a=sessionStorage.getItem("unitCode")||"P01";this.AddressCodeASNSA=sessionStorage.getItem("AddressCodeASNSA")||"JSE-01-01";var s=e.getParameter("arguments").Schedule_No;this.Schedule_No=s.replace(/-/g,"/");var r="/SchedulingAgreements";i.read(r,{urlParameters:{$expand:"DocumentRows",AddressCode:this.AddressCodeASNSA,UnitCode:a},success:function(e){var t=e.results.find(e=>e.ScheduleNum===o.Schedule_No);if(t){o.detailHeaderModel.setData(t);o.detailHeaderModel.refresh(true);o.detailModel.setData(t.DocumentRows.results);o.detailModel.refresh(true);var i=o.getView().getModel("detailModel").getData();for(var a=0;a<i.length;a++){if(i[a].DeliveredQty==="0"){i[a].ConfirmStatus="Open"}else if(i[a].DeliveredQty===i[a].PoQty){i[a].ConfirmStatus="Closed"}else if(i[a].DeliveredQty>"0"&&i[a].DeliveredQty<i[a].PoQty){i[a].ConfirmStatus="Partially"}}o.detailModel.refresh(true)}else{}},error:function(e){var o=JSON.parse(e.response.body);t.error(o.error.message.value)}})}},onCreateAsn:function(){var e=this;var t=e.Schedule_No.replace(/\//g,"-");e.router.navTo("SAAsnCreate",{Schedule_No:t})},onItempress:function(e){var t=e.getParameter("listItem").getBindingContext("detailModel").getObject();var o=t.SchNum_ScheduleNum;var i=o.replace(/\//g,"-");this.router.navTo("ItemDisplay",{Schedule_No:i,Material_No:t.ItemCode,Line_No:t.LineNum})},onChkBoxSelect:function(e){if(!e.getParameter("selected")){this.checkCount--}else{this.checkCount++}this.getView().byId("chkBoxSelectAll").setSelected(false);if(this.checkCount==this.enabledCount){this.getView().byId("chkBoxSelectAll").setSelected(true)}},selectAllCheck:function(e){var t=this;t.detailModel.refresh(true);var o=e.getParameter("selected");var i=t.detailModel.getData();var a=i.Sitemnav;this.checkCount=0;for(var s=0;s<a.length;s++){if(o){this.isSelected=a[s].Confirm_Status;if(this.isSelected=="Not Confirmed"){a[s].Item_indicator=true;this.checkCount++}}else{a[s].Item_indicator=false}}i.Sitemnav.results=a;this.detailModel.setData(i);this.detailModel.refresh(true)},onCofirmAsn:function(e){var t=this.detailModel.getData();this.router.navTo("SAConfirm",{Schedule_No:t.Schedule_No})},onFragClose:function(e){e.getSource().getParent().close()},onMaterialPress:function(e){var t=e.getSource().getParent().getBindingContext("detailModel").getObject();var i=[];i.push(t);if(!this._oPopoverFragment){this._oPopoverFragment=sap.ui.xmlfragment("sap.fiori.asncreationsa.fragment.DetailPopoverFragment",this);this.TableTempId=sap.ui.getCore().byId("TableTempId").clone();this.getView().addDependent(this._oPopoverFragment)}this._oPopoverFragment.setModel(new o(i),"materialDescModel");this._oPopoverFragment.openBy(e.getSource())}})});